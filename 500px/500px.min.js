/* svsdesigns / Surendra V. Singh / 2015-01-21 */
!function(){"use strict";var a,b;b=function(){function b(a,b){return encodeURIComponent(b?b+"["+a+"]":a)}function c(a,c){var d,e,f=[];for(d in a)if(a.hasOwnProperty(d)){var g=a[d];if(g instanceof Array)for(e=0;e<g.length;e++){var h=encodeURIComponent(g[e]);f.push(b(d,c)+"%5B%5D="+h)}else f.push("object"==typeof g?this.object_to_params(g,b(d,c)):b(d,c)+"="+encodeURIComponent(g))}return f.join("&")}var d,e,f,g,h,i,j,k,l,b,c,m,n,o=this,p="https://api.500px.com/",q="v1",r=p+q,s={};for(this.init=function(a){if(this.sdk_key)throw"init: Already initialized";if(!a||!a.sdk_key)throw"init: You must specify an sdk key";if(!document.body)throw"init: Could not find the body element, make sure the document is loaded before calling init";this.sdk_key=a.sdk_key,a&&a.oauth_token&&(d=a.oauth_token);var b,c=document.createElement("div");c.id="_500px_container",c.style.display="none",c.style.width=0,c.style.height=0,c.style.border=0,c.style.margin=0,c.style.padding=0,document.body.appendChild(c),e=document.getElementById("_500px_container"),b=function(){var a=document.getElementById("_500px_container");return document.body.removeChild(a),null}},this.api=function(){if(!this.sdk_key)throw"api: SDK not initialized. Use _500px.init() first.";var a,b,e,f,g,h,i,j;if(a=Array.prototype.slice.call(arguments),b=a.shift(),!b||""==b.replace(/^\s*/,"").replace(/\s*$/,""))throw"api: You must specify an end point";e="get",a[0]&&"string"==typeof a[0]&&(e=a.shift()),f={},a[0]&&"object"==typeof a[0]&&(f=a.shift()),g=function(){},a[0]&&"function"==typeof a[0]&&(g=a.shift()),f._method=e,d&&(f.oauth_token=d),f.sdk_key=this.sdk_key,h=document.createElement("script"),i=k(),window[i]=function(a){document.body.removeChild(h),l(g)(a)},j=r+b+".jsonp",f.callback=i,j+="?",j+=c(f),h.src=j,document.body.appendChild(h)},this.login=function(a){if(!this.sdk_key)throw"login: SDK not initialized. Use _500px.init() first.";var b,c,d;b=k(),window[b]=function(b){n.call(o,a,b)},c=screen.width/2-620,d=screen.height/2-240,window.open(p+"api/js-sdk/authorize?sdk_key="+this.sdk_key+"&callback="+b,"500px_js_sdk_login","width=1240,height=480,left="+c+",top="+d+",menu=no,location=yes,scrollbars=no,status=no,toolbar=no")},this.authorize=function(a){if(!this.sdk_key)throw"authorize: SDK not initialized. Use _500px.init() first.";this.login(a)},this.ensureAuthorization=function(a){if(!this.sdk_key)throw"ensureAuthorization: SDK not initialized. Use _500px.init() first.";var b=function(){a&&a.call(o)};return d?void b():void this.getAuthorizationStatus(function(a){"authorized"==a?b():o.login(function(a){"authorized"==a&&b()})})},this.getAuthorizationStatus=function(a){if(!this.sdk_key)throw"getAuthorizationStatus: SDK not initialized. Use _500px.init() first.";var b=k(),c=document.createElement("iframe");window[b]=function(b){setTimeout(function(){e.removeChild(c)},0),b.not_logged_in?(d=null,a&&"function"==typeof a&&a("not_logged_in")):b.not_authorized?(d=null,a&&"function"==typeof a&&a("not_authorized")):b.token&&(d=b.token,m("authorization_obtained"),a&&"function"==typeof a&&a("authorized"))},c.src=p+"api/js-sdk/check_authorization?sdk_key="+this.sdk_key+"&callback="+b,e.appendChild(c)},this.on=function(a,b){if(s[a]||(s[a]=[]),"function"!=typeof b)throw"on: Callback is not a function";s[a].push(b)},this.off=function(a,b){var c,d;if(b){if(!s[a])return;for(c=0;c<s[a].length;c++)d=s[a][c],d==b&&(s[a][c]=void 0)}else s[a]=[]},this.logout=function(a){if(!this.sdk_key)throw"logout: SDK not initialized. Use _500px.init() first.";if(!d)throw"logout: User is not logged in";var b,c,f=k(),g=document.createElement("iframe");window[f]=function(b){var c;setTimeout(function(){e.removeChild(g)},0),b.no_token_specified?c="no_token_specified":b.invalid_token?c="invalid_token":b.not_logged_in?c="not_logged_in":b.logged_out&&(c="logged_out"),a&&"function"==typeof a&&a(c),m("logout")},navigator.userAgent.match(/MSIE/)?(b=screen.width/2-620,c=screen.height/2-240,window.open(p+"api/js-sdk/authorize?sdk_key="+this.sdk_key+"&token="+d+"&_method=delete&callback="+f,"500px_logout_window","width=1240,height=480,left="+b+",top="+c+",menu=no,location=yes,scrollbars=no,status=yes,toolbar=yes")):g.src=p+"api/js-sdk/authorize?sdk_key="+this.sdk_key+"&token="+d+"&_method=delete&callback="+f,e.appendChild(g)},m=function(a){if(s[a]){var b;for(b=0;b<s[a].length;b++)s[a][b].call(o)}},n=function(a,b){b.denied&&a&&"function"==typeof a?(m("authorization_cancelled"),a.call(o,"denied")):b.token&&(d=b.token,m("authorization_obtained"),a&&"function"==typeof a&&a.call(o,"authorized"))},l=function(b){return function(c){var e=new a(c);b.call(o,e),c.status&&401==c.status&&(d=null,m("logout"))}},k=function(){return"_500pxCallback"+String(Math.round(1e8*Math.random()))},f=["init","api","login","authorize","ensureAuthorization","getAuthorizationStatus","on","off","logout"],g=function(a){return function(){a.apply(o,arguments)}},h=0;h<f.length;h++)i=f[h],j=this[i],this[i]=g(j)},window._500px=new b,a=function(a){this.success=!0,a.status&&200!=a.status&&a.error&&(this.success=!1,this.error_message=a.error,this.status=a.status),this.status||(this.status=200),this.error=!this.success,this.data=a}}();