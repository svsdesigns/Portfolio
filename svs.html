<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        .active {
            color: #cb2326;
        }
    </style>
</head>
<body>
    <ul class="toolbar">
    <li>
        <button class="btn">Pencil</button>
    </li>
    <li>
        <button class="btn">Pen</button>
    </li>
    <li>
        <button class="btn">Eraser</button>
    </li>
</ul>

<div id="distance">asdasd</div>

<script>
  
// Delegate Events in Javascript   
/*var delegate = function(criteria, listener) {
  return function(e) {
    var el = e.target;
    do {
      if (!criteria(el)) continue;
      e.delegateTarget = el;
      listener.apply(this, arguments);
      return;
    } while( (el = el.parentNode) );
  };
};


var toolbar = document.querySelector(".toolbar");
var buttonsFilter = function(elem) { return elem.classList && elem.classList.contains("btn"); };
var buttonHandler = function(e) {
  var button = e.delegateTarget;
    button.classList.toggle("active");
};

toolbar.addEventListener("click", delegate(buttonsFilter, buttonHandler));
*/

// Geolocation API
// if (navigator.geolocation) {
//   console.log('Geolocation is supported!');
// }
// else {
//   console.log('Geolocation is not supported for this Browser/OS version yet.');
// }

// window.onload = function() {
//   var startPos;
//   console.log(navigator.geolocation);
//   navigator.geolocation.getCurrentPosition(function(position) {
//     startPos = position;
//      // console.log(startPos);
//     //document.getElementById('startLat').innerHTML = startPos.coords.latitude;
//     //document.getElementById('startLon').innerHTML = startPos.coords.longitude;
//   });
// };

(function(){

  if(navigator.geolocation){
    

  }
  else{

  }

    //var startData = [];
    navigator.geolocation.getCurrentPosition(function(position){

     var startLat = position.coords.latitude, 
         startLon = position.coords.longitude;

         watch(startLat, startLon);

    }, function(error){
      alert('Error Occurred! Error Code '+error.code);
    });

    function watch(stLat, stLon) {
      navigator.geolocation.watchPosition(function(position){

        //var startLat = startData[0].startLat;
        //var startLon = startData[0].startLon;

        var endLat = position.coords.latitude;
        var endLon = position.coords.longitude;


        //return {'endLat': position.coords.latitude, 'endLon': position.coords.longitude}

        var svs = distance(stLat, stLon, endLat, endLon);
        
        document.getElementById('distance').innerHTML = svs;
        
        

      });
    }

    function distance(lat1, lon1, lat2, lon2){
      var R = 6371; // km
      var dLat = (lat2 - lat1).toRad();
      var dLon = (lon2 - lon1).toRad(); 
      var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(lat1.toRad()) * Math.cos(lat2.toRad()) * 
              Math.sin(dLon / 2) * Math.sin(dLon / 2); 
      var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)); 
      var d = R * c;
      return d;
  }

  Number.prototype.toRad = function() {
    return this * Math.PI / 180;
  }
 


    

})();

</script>
</body>
</html>